# Redis é›†ç¾¤éƒ¨ç½²æˆåŠŸæ€»ç»“

## ğŸ‰ éƒ¨ç½²çŠ¶æ€: æˆåŠŸ

**éƒ¨ç½²æ—¶é—´**: 2025-06-03  
**ç³»ç»Ÿå¹³å°**: Windows 10 (PowerShell)

## ğŸ“Š ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### Redis é›†ç¾¤é…ç½®
- **é›†ç¾¤æ¨¡å¼**: 3ä¸»3ä» (Master-Slave)
- **æ•°æ®åˆ†ç‰‡**: 16384ä¸ªå“ˆå¸Œæ§½åˆ†å¸ƒåœ¨3ä¸ªä¸»èŠ‚ç‚¹
- **é«˜å¯ç”¨æ€§**: æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„ä»èŠ‚ç‚¹
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**: æ”¯æŒèŠ‚ç‚¹æ•…éšœæ—¶çš„è‡ªåŠ¨åˆ‡æ¢

### é›†ç¾¤èŠ‚ç‚¹è¯¦æƒ…
| èŠ‚ç‚¹ç±»å‹ | å®¹å™¨åç§° | ç«¯å£æ˜ å°„ | å“ˆå¸Œæ§½èŒƒå›´ | çŠ¶æ€ |
|---------|---------|---------|------------|------|
| Master-1 | redis-master-1 | 7001:7001 | 0-5460 | âœ… è¿è¡Œä¸­ |
| Master-2 | redis-master-2 | 7002:7002 | 5461-10922 | âœ… è¿è¡Œä¸­ |
| Master-3 | redis-master-3 | 7003:7003 | 10923-16383 | âœ… è¿è¡Œä¸­ |
| Slave-1 | redis-slave-1 | 7004:7004 | Master-3å‰¯æœ¬ | âœ… è¿è¡Œä¸­ |
| Slave-2 | redis-slave-2 | 7005:7005 | Master-1å‰¯æœ¬ | âœ… è¿è¡Œä¸­ |
| Slave-3 | redis-slave-3 | 7006:7006 | Master-2å‰¯æœ¬ | âœ… è¿è¡Œä¸­ |

## ğŸ› ï¸ è§£å†³çš„é—®é¢˜

### 1. Redis é›†ç¾¤åˆå§‹åŒ–å¤±è´¥
**é—®é¢˜**: `docker-compose.yml` ä¸­çš„Redisé›†ç¾¤åˆå§‹åŒ–å®¹å™¨å‘½ä»¤æ ¼å¼é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**: 
- é‡æ–°è®¾è®¡äº†é›†ç¾¤åˆå§‹åŒ–æµç¨‹
- åˆ›å»ºäº†ä¸“ç”¨çš„ `init-cluster.ps1` PowerShellè„šæœ¬
- æ‰‹åŠ¨æ‰§è¡Œé›†ç¾¤åˆå§‹åŒ–å‘½ä»¤

### 2. PowerShell è„šæœ¬è¾“å‡ºæ ¼å¼æ··ä¹±
**é—®é¢˜**: `check-cluster.ps1` è„šæœ¬è¾“å‡ºé‡å¤å’Œæ ¼å¼é”™ä¹±
**è§£å†³æ–¹æ¡ˆ**:
- é‡æ„äº† PowerShell è„šæœ¬ç»“æ„
- ä¼˜åŒ–äº†è¾“å‡ºæ ¼å¼å’Œé”™è¯¯å¤„ç†
- ç»Ÿä¸€äº†çŠ¶æ€æ£€æŸ¥é€»è¾‘

### 3. Prometheus é…ç½®æ–‡ä»¶é—®é¢˜
**é—®é¢˜**: `prometheus.yml` è¢«é”™è¯¯åœ°åˆ›å»ºä¸ºç›®å½•è€Œä¸æ˜¯æ–‡ä»¶
**è§£å†³æ–¹æ¡ˆ**:
- åˆ é™¤äº†é”™è¯¯çš„ç›®å½•ç»“æ„
- é‡æ–°åˆ›å»ºäº†æ­£ç¡®çš„ `prometheus.yml` é…ç½®æ–‡ä»¶
- ä¿®å¤äº†ç›‘æ§æœåŠ¡çš„å¯åŠ¨é—®é¢˜

### 4. èŠå¤©æœåŠ¡å™¨ Redis è¿æ¥å¤±è´¥
**é—®é¢˜**: èŠå¤©æœåŠ¡å™¨ä»ç„¶å°è¯•è¿æ¥æ—§çš„ `redis` ä¸»æœºå
**è§£å†³æ–¹æ¡ˆ**:
- æ›´æ–°äº† `config.json` ä¸­çš„Redisä¸»æœºé…ç½®
- å°†Hostä» `redis` æ›´æ”¹ä¸º `redis-master-1`
- ç¡®ä¿é›†ç¾¤æ¨¡å¼ä¼˜å…ˆä½¿ç”¨

## âœ… å½“å‰ç³»ç»ŸçŠ¶æ€

### æœåŠ¡è¿è¡ŒçŠ¶æ€
- âœ… **MySQLé›†ç¾¤**: 1ä¸»2ä»+2åˆ†ç‰‡ - æ­£å¸¸è¿è¡Œ
- âœ… **Redisé›†ç¾¤**: 3ä¸»3ä» - æ­£å¸¸è¿è¡Œå¹¶é€šè¿‡è¯»å†™æµ‹è¯•
- âœ… **èŠå¤©æœåŠ¡å™¨**: TCP(9000) + HTTP(8080) - æ­£å¸¸è¿è¡Œ
- âœ… **ç›‘æ§æœåŠ¡**: Prometheus(9090) + Grafana(3000) - æ­£å¸¸è¿è¡Œ
- âœ… **ç®¡ç†å·¥å…·**: Adminer(8081) - æ­£å¸¸è¿è¡Œ

### ç½‘ç»œè¿é€šæ€§
æ‰€æœ‰ç«¯å£éƒ½å¯ä»¥æ­£å¸¸è®¿é—®:
- MySQL Master: 3316 âœ…
- RedisèŠ‚ç‚¹: 7001-7006 âœ…  
- èŠå¤©æœåŠ¡å™¨: 9000(TCP), 8080(HTTP) âœ…
- ç›‘æ§é¢æ¿: 9090(Prometheus), 3000(Grafana) âœ…
- æ•°æ®åº“ç®¡ç†: 8081(Adminer) âœ…

### é›†ç¾¤åŠŸèƒ½éªŒè¯
- âœ… **é›†ç¾¤çŠ¶æ€**: cluster_state:ok
- âœ… **æ•°æ®åˆ†ç‰‡**: 16384ä¸ªæ§½ä½æ­£ç¡®åˆ†é…
- âœ… **è¯»å†™æµ‹è¯•**: é›†ç¾¤è¯»å†™åŠŸèƒ½æ­£å¸¸
- âœ… **æ•…éšœè½¬ç§»**: ä¸»ä»å¤åˆ¶é…ç½®æ­£ç¡®

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### å¯åŠ¨ç³»ç»Ÿ
```powershell
# å®Œæ•´å¯åŠ¨
.\start-cluster.ps1

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨Redisé›†ç¾¤
.\init-cluster.ps1
```

### çŠ¶æ€æ£€æŸ¥
```powershell
# è¿è¡Œç³»ç»Ÿæ£€æŸ¥
.\check-cluster.ps1
```

### è®¿é—®æœåŠ¡
- **èŠå¤©æœåŠ¡å™¨**: `localhost:9000` (TCP), `localhost:8080` (HTTP)
- **æ•°æ®åº“ç®¡ç†**: http://localhost:8081
- **ç³»ç»Ÿç›‘æ§**: http://localhost:9090 (Prometheus)
- **å¯è§†åŒ–é¢æ¿**: http://localhost:3000 (Grafana, admin/admin)

### Redis é›†ç¾¤æ“ä½œ
```bash
# è¿æ¥åˆ°é›†ç¾¤
docker exec -it redis-master-1 redis-cli -c -p 7001

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
docker exec redis-master-1 redis-cli -p 7001 cluster info

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
docker exec redis-master-1 redis-cli -p 7001 cluster nodes

# æµ‹è¯•é›†ç¾¤
docker exec redis-master-1 redis-cli -c -p 7001 set test-key "hello"
docker exec redis-master-1 redis-cli -c -p 7001 get test-key
```

## ğŸ”§ ç»´æŠ¤å‘½ä»¤

```powershell
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs chat-server
docker-compose logs redis-master-1

# é‡å¯æœåŠ¡
docker-compose restart chat-server
docker-compose restart redis-master-1

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# æ¸…ç†å’Œé‡å»º
docker-compose down
docker-compose up -d
```

## ğŸ“ˆ æ€§èƒ½é…ç½®

### Redis é›†ç¾¤é…ç½®
- **è¿æ¥æ± å¤§å°**: 50
- **æœ€å°ç©ºé—²è¿æ¥**: 20  
- **æœ€å¤§é‡è¯•æ¬¡æ•°**: 3
- **è¶…æ—¶è®¾ç½®**: è¿æ¥5s, è¯»å†™3s

### MySQL é…ç½®
- **æœ€å¤§è¿æ¥æ•°**: 100
- **æœ€å¤§ç©ºé—²è¿æ¥**: 10
- **è¿æ¥æ± **: ä¸»ä»åˆ†ç¦» + åˆ†ç‰‡

## ğŸš€ éƒ¨ç½²ç‰¹ç‚¹

### é«˜å¯ç”¨æ€§
- Redisä¸»ä»å¤åˆ¶ç¡®ä¿æ•°æ®å®‰å…¨
- MySQLä¸»ä»+åˆ†ç‰‡æ¶æ„
- è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»

### å¯æ‰©å±•æ€§
- Redisé›†ç¾¤æ”¯æŒæ°´å¹³æ‰©å±•
- MySQLåˆ†ç‰‡æ”¯æŒæ•°æ®å¢é•¿
- å¾®æœåŠ¡æ¶æ„ä¾¿äºåŠŸèƒ½æ‰©å±•

### ç›‘æ§å®Œå¤‡
- PrometheusæŒ‡æ ‡æ”¶é›†
- Grafanaå¯è§†åŒ–é¢æ¿
- å®æ—¶çŠ¶æ€æ£€æŸ¥è„šæœ¬

## ğŸŠ éƒ¨ç½²æ€»ç»“

æœ¬æ¬¡Redisé›†ç¾¤éƒ¨ç½²å®Œå…¨æˆåŠŸï¼Œå®ç°äº†ä»å•Rediså®ä¾‹åˆ°Redisé›†ç¾¤çš„å®Œæ•´è¿ç§»ã€‚ç³»ç»Ÿç°åœ¨å…·å¤‡:

1. **é«˜å¯ç”¨æ€§**: 3ä¸»3ä»Redisé›†ç¾¤ + MySQLä¸»ä»æ¶æ„
2. **æ•°æ®å®‰å…¨**: è‡ªåŠ¨å¤‡ä»½å’Œæ•…éšœè½¬ç§»
3. **æ€§èƒ½ä¼˜åŒ–**: è¿æ¥æ± å’Œç¼“å­˜ç­–ç•¥
4. **ç›‘æ§å®Œå–„**: å…¨æ–¹ä½ç³»ç»Ÿç›‘æ§
5. **è¿ç»´å‹å¥½**: PowerShellè‡ªåŠ¨åŒ–è„šæœ¬

ç³»ç»Ÿå·²å‡†å¤‡å¥½æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼ğŸ‰ 